# æ•°æ®åŒæ­¥é—®é¢˜

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**   
- [batch-analysis-concurrent-fix.md](file://docs/troubleshooting/batch-analysis-concurrent-fix.md)
- [data_consistency_checker.py](file://app/services/data_consistency_checker.py)
- [multi_source_basics_sync_service.py](file://app/services/multi_source_basics_sync_service.py)
- [tushare_sync_service.py](file://app/worker/tushare_sync_service.py)
- [akshare_sync_service.py](file://app/worker/akshare_sync_service.py)
- [rate_limiter.py](file://app/core/rate_limiter.py)
- [manager.py](file://app/services/data_sources/manager.py)
- [multi_source_sync.py](file://app/routers/multi_source_sync.py)
- [sync.py](file://app/routers/sync.py)
- [manual_sync_trigger.py](file://scripts/manual_sync_trigger.py)
</cite>

## ç›®å½•
1. [å¼•è¨€](#å¼•è¨€)
2. [æ‰¹é‡åˆ†æå¹¶å‘é—®é¢˜](#æ‰¹é‡åˆ†æå¹¶å‘é—®é¢˜)
3. [æ•°æ®æºåŒæ­¥å¤±è´¥å¤„ç†](#æ•°æ®æºåŒæ­¥å¤±è´¥å¤„ç†)
4. [æ•°æ®ä¸ä¸€è‡´è¯Šæ–­ä¸è§£å†³](#æ•°æ®ä¸ä¸€è‡´è¯Šæ–­ä¸è§£å†³)
5. [æ•°æ®æºé™æµä¸è¿æ¥é—®é¢˜](#æ•°æ®æºé™æµä¸è¿æ¥é—®é¢˜)
6. [æ•°æ®å›å¡«ä¸æ‰‹åŠ¨åŒæ­¥](#æ•°æ®å›å¡«ä¸æ‰‹åŠ¨åŒæ­¥)
7. [æ€»ç»“](#æ€»ç»“)

## å¼•è¨€

æœ¬æŒ‡å—æ—¨åœ¨ä¸ºæ•°æ®åŒæ­¥è¿‡ç¨‹ä¸­é‡åˆ°çš„å„ç±»é—®é¢˜æä¾›æ·±åº¦æ’æŸ¥å’Œè§£å†³æ–¹æ¡ˆã€‚ç³»ç»Ÿé›†æˆäº†Tushareã€AKShareã€BaoStockç­‰å¤šä¸ªæ•°æ®æºï¼Œæ”¯æŒå¤šå‘¨æœŸã€å¤šå¸‚åœºçš„æ•°æ®åŒæ­¥ã€‚ç„¶è€Œï¼Œåœ¨å®é™…è¿è¡Œä¸­å¯èƒ½ä¼šé‡åˆ°æ‰¹é‡åˆ†æå¹¶å‘æ‰§è¡Œé—®é¢˜ã€æ•°æ®æºåŒæ­¥å¤±è´¥ã€æ•°æ®ä¸ä¸€è‡´ã€é™æµè¿æ¥å¼‚å¸¸ç­‰æŒ‘æˆ˜ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†è§£é‡Š`batch-analysis-concurrent-fix.md`ä¸­æåˆ°çš„å¹¶å‘å®‰å…¨é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼ŒæŒ‡å¯¼ç”¨æˆ·å¦‚ä½•éªŒè¯æ•°æ®åŒæ­¥çŠ¶æ€ï¼Œæ£€æŸ¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œæƒ…å†µï¼Œè¯Šæ–­æ•°æ®å®Œæ•´æ€§é—®é¢˜ï¼Œå¹¶æä¾›åº”æ€¥æ“ä½œæ­¥éª¤ã€‚

**Section sources**
- [batch-analysis-concurrent-fix.md](file://docs/troubleshooting/batch-analysis-concurrent-fix.md)

## æ‰¹é‡åˆ†æå¹¶å‘é—®é¢˜

### é—®é¢˜æè¿°

åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·æäº¤æ‰¹é‡åˆ†æä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿå¹¶æœªçœŸæ­£å®ç°å¹¶å‘æ‰§è¡Œï¼Œè€Œæ˜¯ä¸²è¡Œå¤„ç†ã€‚è¿™æ„å‘³ç€åˆ†æ3åªè‚¡ç¥¨çš„æ€»è€—æ—¶ç­‰äºå•ä¸ªä»»åŠ¡è€—æ—¶çš„3å€ï¼Œä¸¥é‡å½±å“äº†ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿæ•ˆç‡ã€‚

### æ ¹æœ¬åŸå› 

ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°å­˜åœ¨ä¸‰ä¸ªå…³é”®é—®é¢˜ï¼š

1.  **FastAPI BackgroundTasks ä¸²è¡Œæ‰§è¡Œ**ï¼šFastAPIçš„`BackgroundTasks`æœºåˆ¶åœ¨å†…éƒ¨ä½¿ç”¨`for task in self.tasks: await task()`æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå¯¼è‡´ä»»åŠ¡è¢«ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œè€Œéå¹¶å‘ã€‚
2.  **çº¿ç¨‹æ± é…ç½®ä¸å½“**ï¼šæ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°çš„çº¿ç¨‹æ± ï¼Œå¯¼è‡´èµ„æºæµªè´¹å’Œæ½œåœ¨çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚
3.  **å®ä¾‹å…±äº«å¯¼è‡´çŠ¶æ€æ±¡æŸ“**ï¼šå¤šä¸ªä»»åŠ¡å…±äº«åŒä¸€ä¸ª`TradingAgentsGraph`å®ä¾‹ï¼Œå¯¼è‡´ä»»åŠ¡é—´çš„å¯å˜çŠ¶æ€ï¼ˆå¦‚`ticker`ã€`curr_state`ï¼‰ç›¸äº’è¦†ç›–ï¼Œé€ æˆä¸¥é‡çš„æ•°æ®æ··æ·†ã€‚

### è§£å†³æ–¹æ¡ˆ

ç³»ç»Ÿå·²é€šè¿‡ä»¥ä¸‹æ–¹å¼å½»åº•è§£å†³äº†å¹¶å‘é—®é¢˜ï¼š

1.  **ä½¿ç”¨ `asyncio.create_task` å®ç°çœŸæ­£å¹¶å‘**ï¼šåœ¨`app/routers/analysis.py`çš„`submit_batch_analysis`ç«¯ç‚¹ä¸­ï¼Œä¸å†ä½¿ç”¨`BackgroundTasks`ï¼Œè€Œæ˜¯ä½¿ç”¨`asyncio.create_task`åœ¨åå°å¯åŠ¨å¹¶å‘ä»»åŠ¡ï¼Œå¹¶é€šè¿‡`asyncio.gather`ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆã€‚
2.  **åˆ›å»ºå…±äº«çº¿ç¨‹æ± **ï¼šåœ¨`simple_analysis_service.py`ä¸­ï¼Œå°†çº¿ç¨‹æ± ä½œä¸ºæœåŠ¡å®ä¾‹çš„æˆå‘˜å˜é‡åœ¨`__init__`ä¸­åˆå§‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰ä»»åŠ¡å…±äº«åŒä¸€ä¸ªçº¿ç¨‹æ± ï¼Œé¿å…äº†èµ„æºç«äº‰ã€‚
3.  **ç¡®ä¿å®ä¾‹éš”ç¦»**ï¼šä¿®æ”¹`_get_trading_graph`æ–¹æ³•ï¼Œæ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„`TradingAgentsGraph`å®ä¾‹ï¼Œä»æ ¹æœ¬ä¸Šæœç»äº†çŠ¶æ€å…±äº«é—®é¢˜ã€‚

### éªŒè¯æ–¹æ³•

1.  **æ£€æŸ¥æ—¥å¿—**ï¼šæäº¤æ‰¹é‡åˆ†æåï¼ŒæŸ¥çœ‹æ—¥å¿—æ˜¯å¦å‡ºç°ç±»ä¼¼`ğŸš€ [å¹¶å‘ä»»åŠ¡] å¼€å§‹æ‰§è¡Œ: task-1 - 000001`ã€`ğŸš€ [å¹¶å‘ä»»åŠ¡] å¼€å§‹æ‰§è¡Œ: task-2 - 000002`çš„è®°å½•ï¼Œç¡®è®¤å¤šä¸ªä»»åŠ¡åŒæ—¶å¼€å§‹ã€‚
2.  **æ£€æŸ¥ä»»åŠ¡ä¸­å¿ƒ**ï¼šä»»åŠ¡ä¸­å¿ƒåº”æ˜¾ç¤ºå¤šä¸ªâ€œè¿›è¡Œä¸­â€çš„ä»»åŠ¡ï¼Œè€Œéåªæœ‰ä¸€ä¸ªã€‚
3.  **æ£€æŸ¥æ€»è€—æ—¶**ï¼š3ä¸ªä»»åŠ¡çš„æ€»è€—æ—¶åº”æ¥è¿‘å•ä¸ªä»»åŠ¡çš„è€—æ—¶ï¼Œè€Œé3å€ã€‚

**Section sources**
- [batch-analysis-concurrent-fix.md](file://docs/troubleshooting/batch-analysis-concurrent-fix.md)

## æ•°æ®æºåŒæ­¥å¤±è´¥å¤„ç†

### éªŒè¯æ•°æ®åŒæ­¥çŠ¶æ€

ç³»ç»Ÿæä¾›äº†APIæ¥æŸ¥è¯¢åŒæ­¥çŠ¶æ€ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ï¼š

```mermaid
flowchart TD
A[ç”¨æˆ·] --> B[è°ƒç”¨ /api/sync/multi-source/status]
B --> C{çŠ¶æ€æ£€æŸ¥}
C --> |æˆåŠŸ| D[è¿”å›åŒæ­¥çŠ¶æ€]
C --> |å¤±è´¥| E[è¿”å›é”™è¯¯ä¿¡æ¯]
D --> F[è§£æçŠ¶æ€ä¿¡æ¯]
F --> G[åˆ¤æ–­æ˜¯å¦æ­£åœ¨è¿è¡Œ]
G --> H[æ£€æŸ¥æœ€ååŒæ­¥æ—¶é—´]
H --> I[æŸ¥çœ‹é”™è¯¯è®¡æ•°]
```

**Diagram sources**
- [multi_source_sync.py](file://app/routers/multi_source_sync.py#L137-L149)
- [multi_source_basics_sync_service.py](file://app/services/multi_source_basics_sync_service.py#L66-L77)

- **APIç«¯ç‚¹**ï¼š
  - `GET /api/sync/multi-source/status`ï¼šè·å–å¤šæ•°æ®æºåŸºç¡€ä¿¡æ¯åŒæ­¥çŠ¶æ€ã€‚
  - `GET /api/sync/stock_basics/status`ï¼šè·å–ä¼ ç»ŸåŸºç¡€ä¿¡æ¯åŒæ­¥çŠ¶æ€ã€‚
- **å…³é”®å­—æ®µ**ï¼š
  - `status`ï¼šå½“å‰çŠ¶æ€ï¼ˆ`idle`, `running`, `success`, `failed`ï¼‰ã€‚
  - `started_at` å’Œ `finished_at`ï¼šåŒæ­¥ä»»åŠ¡çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚
  - `total`, `inserted`, `updated`, `errors`ï¼šç»Ÿè®¡ä¿¡æ¯ã€‚
  - `data_sources_used`ï¼šæœ¬æ¬¡åŒæ­¥ä½¿ç”¨äº†å“ªäº›æ•°æ®æºã€‚

### æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ‰§è¡Œæƒ…å†µ

ç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡ç”±`scheduler_service.py`ç®¡ç†ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€æŸ¥ï¼š

1.  **è·å–æ‰€æœ‰ä»»åŠ¡**ï¼š`GET /api/scheduler/jobs` å¯ä»¥åˆ—å‡ºæ‰€æœ‰å®šæ—¶ä»»åŠ¡åŠå…¶çŠ¶æ€ï¼ˆè¿è¡Œä¸­ã€æš‚åœï¼‰ã€‚
2.  **è·å–æ‰§è¡Œå†å²**ï¼š`GET /api/scheduler/history` å¯ä»¥æŸ¥çœ‹ä»»åŠ¡çš„å†å²æ‰§è¡Œè®°å½•ï¼ŒåŒ…æ‹¬æ‰§è¡Œæ—¶é—´ã€çŠ¶æ€å’Œè€—æ—¶ã€‚
3.  **è·å–ç»Ÿè®¡ä¿¡æ¯**ï¼š`GET /api/scheduler/stats` æä¾›äº†ä»»åŠ¡æ€»æ•°ã€è¿è¡Œä¸­ä»»åŠ¡æ•°ç­‰æ¦‚è§ˆä¿¡æ¯ã€‚

**Section sources**
- [multi_source_sync.py](file://app/routers/multi_source_sync.py#L137-L149)
- [scheduler_service.py](file://app/services/scheduler_service.py#L375-L1159)

## æ•°æ®ä¸ä¸€è‡´è¯Šæ–­ä¸è§£å†³

### è¯Šæ–­æ•°æ®å®Œæ•´æ€§é—®é¢˜

å½“æ€€ç–‘æ•°æ®ä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè¯Šæ–­ï¼š

1.  **å¯¹æ¯”ä¸åŒæ•°æ®æºçš„è‚¡ç¥¨ä»£ç **ï¼š
    - ä½¿ç”¨è„šæœ¬`scripts/check_missing_stocks.py`æ¥æ£€æŸ¥ä¸åŒæ•°æ®æºä¹‹é—´æ˜¯å¦å­˜åœ¨è‚¡ç¥¨ä»£ç ç¼ºå¤±ã€‚
    - æŸ¥è¯¢`stock_basic_info`é›†åˆï¼Œæ£€æŸ¥`code`å­—æ®µæ˜¯å¦å®Œæ•´ä¸”æ ¼å¼ç»Ÿä¸€ã€‚

2.  **æ£€æŸ¥è´¢åŠ¡æ•°æ®å­—æ®µç¼ºå¤±**ï¼š
    - ä½¿ç”¨è„šæœ¬`scripts/check_financial_data.py`æˆ–`scripts/debug/debug_valuation_data.py`æ¥æ£€æŸ¥`stock_financial_data`é›†åˆä¸­å…³é”®å­—æ®µï¼ˆå¦‚`net_profit`, `revenue`, `total_hldr_eqy_exc_min_int`ï¼‰æ˜¯å¦å­˜åœ¨ã€‚
    - é€šè¿‡API `/api/financial-data/{symbol}` è·å–ç‰¹å®šè‚¡ç¥¨çš„è´¢åŠ¡æ•°æ®ï¼Œæ£€æŸ¥å“åº”ä¸­æ˜¯å¦æœ‰ç¼ºå¤±å­—æ®µã€‚

### æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶

ç³»ç»Ÿå†…ç½®äº†`DataConsistencyChecker`æœåŠ¡ï¼Œç”¨äºå¤„ç†å¤šæ•°æ®æºä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚

```mermaid
classDiagram
class DataConsistencyChecker {
+tolerance_thresholds : Dict[str, float]
+metric_weights : Dict[str, float]
+check_daily_basic_consistency(primary_data, secondary_data) DataConsistencyResult
+resolve_data_conflicts(primary_data, secondary_data, result) Tuple[DataFrame, str]
}
class DataConsistencyResult {
+is_consistent : bool
+primary_source : str
+secondary_source : str
+differences : Dict[str, Any]
+confidence_score : float
+recommended_action : str
}
DataConsistencyChecker --> DataConsistencyResult : "è¿”å›"
```

**Diagram sources**
- [data_consistency_checker.py](file://app/services/data_consistency_checker.py#L35-L319)

- **å·¥ä½œæµç¨‹**ï¼š
  1.  **æ•°æ®æºç®¡ç†å™¨** (`DataSourceManager`) ä¼šæŒ‰ä¼˜å…ˆçº§ï¼ˆTushare > AKShare > BaoStockï¼‰å°è¯•ä»ä¸»æ•°æ®æºå’Œå¤‡ç”¨æ•°æ®æºè·å–æ•°æ®ã€‚
  2.  **ä¸€è‡´æ€§æ£€æŸ¥**ï¼š`DataConsistencyChecker`ä¼šæ¯”è¾ƒä¸¤ä¸ªæ•°æ®æºçš„`PE`ã€`PB`ã€`æ€»å¸‚å€¼`ç­‰å…³é”®æŒ‡æ ‡ï¼Œè®¡ç®—å·®å¼‚ç™¾åˆ†æ¯”ã€‚
  3.  **ç½®ä¿¡åº¦è¯„åˆ†**ï¼šæ ¹æ®å„æŒ‡æ ‡çš„å·®å¼‚å’Œé¢„è®¾çš„å®¹å¿åº¦é˜ˆå€¼ï¼ˆå¦‚PEå…è®¸5%å·®å¼‚ï¼‰ï¼Œè®¡ç®—ä¸€ä¸ªç»¼åˆçš„ç½®ä¿¡åº¦åˆ†æ•°ã€‚
  4.  **è§£å†³å†²çª**ï¼šæ ¹æ®ç½®ä¿¡åº¦åˆ†æ•°ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å†³å®šé‡‡ç”¨å“ªä¸ªæ•°æ®æºçš„æ•°æ®ï¼š
      - `confidence_score > 0.8`ï¼šæ•°æ®é«˜åº¦ä¸€è‡´ï¼Œå¯ä½¿ç”¨ä»»ä¸€æ•°æ®æºã€‚
      - `confidence_score > 0.6`ï¼šä½¿ç”¨ä¸»æ•°æ®æºä½†å‘å‡ºè­¦å‘Šã€‚
      - `confidence_score <= 0.3`ï¼šéœ€è¦äººå·¥è°ƒæŸ¥æ•°æ®æºé—®é¢˜ã€‚

**Section sources**
- [data_consistency_checker.py](file://app/services/data_consistency_checker.py#L35-L319)
- [manager.py](file://app/services/data_sources/manager.py#L219-L279)

## æ•°æ®æºé™æµå’Œè¿æ¥é—®é¢˜

### Tushare é™æµå¤„ç†

Tushareæ ¹æ®ç”¨æˆ·çš„ç§¯åˆ†ç­‰çº§æœ‰ä¸åŒçš„APIè°ƒç”¨é¢‘ç‡é™åˆ¶ã€‚ç³»ç»Ÿé€šè¿‡`TushareRateLimiter`è¿›è¡Œç²¾ç¡®æ§åˆ¶ã€‚

- **é™æµé…ç½®**ï¼šåœ¨`app/core/rate_limiter.py`ä¸­ï¼Œ`TIER_LIMITS`å®šä¹‰äº†ä¸åŒç­‰çº§ï¼ˆfree, basic, standard, premium, vipï¼‰çš„é™æµè§„åˆ™ã€‚
- **å®‰å…¨è¾¹é™…**ï¼šç³»ç»Ÿé»˜è®¤ä½¿ç”¨80%çš„å®‰å…¨è¾¹é™…ï¼Œå³å®é™…è°ƒç”¨é¢‘ç‡ä¸ºç†è®ºé™åˆ¶çš„80%ï¼Œä»¥é¿å…å› ç½‘ç»œæ³¢åŠ¨å¯¼è‡´çš„é™æµã€‚
- **é”™è¯¯å¤„ç†**ï¼šå½“APIè¿”å›â€œæ¯åˆ†é’Ÿæœ€å¤šè®¿é—®â€ã€â€œrate limitâ€ç­‰é”™è¯¯æ—¶ï¼Œ`_is_rate_limit_error`æ–¹æ³•ä¼šè¯†åˆ«å¹¶è®°å½•ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é™çº§æˆ–ç­‰å¾…ã€‚

### AKShare è¿æ¥é—®é¢˜

AKShareä½œä¸ºå¼€æºåº“ï¼Œå…¶ç¨³å®šæ€§ä¾èµ–äºç½‘ç»œå’Œä¸Šæ¸¸æ•°æ®æºã€‚

- **é€Ÿç‡é™åˆ¶**ï¼šç³»ç»Ÿä¸ºAKShareé…ç½®äº†ä¿å®ˆçš„é™æµç­–ç•¥ï¼ˆé»˜è®¤60æ¬¡/åˆ†é’Ÿï¼‰ï¼Œé€šè¿‡`AKShareRateLimiter`å®ç°ã€‚
- **è¿æ¥æµ‹è¯•**ï¼š`DataSourceManager`åœ¨åˆå§‹åŒ–æ—¶ä¼šæµ‹è¯•æ¯ä¸ªæ•°æ®æºçš„è¿é€šæ€§ï¼Œç¡®ä¿æœåŠ¡å¯ç”¨ã€‚
- **é™çº§æœºåˆ¶**ï¼šå½“ä¸»æ•°æ®æºï¼ˆå¦‚Tushareï¼‰ä¸å¯ç”¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æºï¼ˆå¦‚AKShareæˆ–BaoStockï¼‰ã€‚

```mermaid
sequenceDiagram
participant ç”¨æˆ·
participant API
participant æ•°æ®æºç®¡ç†å™¨
participant Tushare
participant AKShare
ç”¨æˆ·->>API : è¯·æ±‚æ•°æ®
API->>æ•°æ®æºç®¡ç†å™¨ : è·å–æ•°æ® (ä¼˜å…ˆçº§ : Tushare)
æ•°æ®æºç®¡ç†å™¨->>Tushare : è°ƒç”¨API
alt Tushareå¯ç”¨ä¸”æœªé™æµ
Tushare-->>æ•°æ®æºç®¡ç†å™¨ : è¿”å›æ•°æ®
æ•°æ®æºç®¡ç†å™¨-->>API : è¿”å›æ•°æ®
API-->>ç”¨æˆ· : è¿”å›ç»“æœ
else Tushareå¤±è´¥æˆ–é™æµ
æ•°æ®æºç®¡ç†å™¨->>AKShare : è°ƒç”¨API (å¤‡ç”¨)
AKShare-->>æ•°æ®æºç®¡ç†å™¨ : è¿”å›æ•°æ®
æ•°æ®æºç®¡ç†å™¨-->>API : è¿”å›æ•°æ®
API-->>ç”¨æˆ· : è¿”å›ç»“æœ
end
```

**Diagram sources**
- [rate_limiter.py](file://app/core/rate_limiter.py#L100-L145)
- [manager.py](file://app/services/data_sources/manager.py#L103-L138)

**Section sources**
- [rate_limiter.py](file://app/core/rate_limiter.py#L100-L145)
- [tushare_sync_service.py](file://app/worker/tushare_sync_service.py#L380-L387)
- [akshare_sync_service.py](file://app/worker/akshare_sync_service.py#L147-L167)

## æ•°æ®å›å¡«å’Œæ‰‹åŠ¨è§¦å‘åŒæ­¥

### åº”æ€¥æ“ä½œæ­¥éª¤

å½“è‡ªåŠ¨åŒæ­¥å¤±è´¥æˆ–éœ€è¦ç´§æ€¥æ›´æ–°æ•°æ®æ—¶ï¼Œå¯ä»¥æ‰§è¡Œæ‰‹åŠ¨åŒæ­¥ã€‚

1.  **æ‰‹åŠ¨è§¦å‘åŒæ­¥**ï¼š
    - ä½¿ç”¨æä¾›çš„è„šæœ¬`scripts/manual_sync_trigger.py`ï¼Œè¯¥è„šæœ¬ä¼šè‡ªåŠ¨ç™»å½•å¹¶è§¦å‘å†å²æ•°æ®ã€è´¢åŠ¡æ•°æ®å’Œæ–°é—»æ•°æ®çš„åŒæ­¥ã€‚
    - æˆ–è€…ï¼Œç›´æ¥è°ƒç”¨APIï¼š
      - `POST /api/multi-period-sync/start-incremental?days_back=30`ï¼šå¯åŠ¨æœ€è¿‘30å¤©çš„å†å²æ•°æ®å¢é‡åŒæ­¥ã€‚
      - `POST /api/financial-data/sync/start`ï¼šå¯åŠ¨è´¢åŠ¡æ•°æ®åŒæ­¥ã€‚

2.  **æ•°æ®å›å¡«**ï¼š
    - å¯¹äºå†å²æ•°æ®ï¼Œå¯ä»¥é€šè¿‡`sync_historical_data`æ–¹æ³•æŒ‡å®š`start_date`å’Œ`end_date`è¿›è¡Œå…¨é‡æˆ–å¢é‡å›å¡«ã€‚
    - å¯¹äºå®æ—¶è¡Œæƒ…ï¼Œ`sync_realtime_quotes`æ–¹æ³•æ”¯æŒæŒ‡å®š`symbols`åˆ—è¡¨ï¼Œå¯ä»¥å¯¹ç‰¹å®šè‚¡ç¥¨è¿›è¡Œæ•°æ®å›å¡«ã€‚

### å®šæ—¶ä»»åŠ¡ç®¡ç†

- **æš‚åœ/æ¢å¤ä»»åŠ¡**ï¼š`POST /api/scheduler/jobs/{job_id}/pause` å’Œ `POST /api/scheduler/jobs/{job_id}/resume`ã€‚
- **æ‰‹åŠ¨è§¦å‘ä»»åŠ¡**ï¼š`POST /api/scheduler/jobs/{job_id}/trigger`ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œä¸€æ¬¡å®šæ—¶ä»»åŠ¡ã€‚

**Section sources**
- [manual_sync_trigger.py](file://scripts/manual_sync_trigger.py#L31-L214)
- [tushare_sync_service.py](file://app/worker/tushare_sync_service.py#L543-L740)
- [scheduler_management.md](file://docs/guides/scheduler_management.md#L192-L196)

## æ€»ç»“

æœ¬æŒ‡å—è¯¦ç»†é˜è¿°äº†æ•°æ®åŒæ­¥ç³»ç»Ÿä¸­çš„æ ¸å¿ƒé—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡é‡‡ç”¨`asyncio.create_task`è§£å†³äº†æ‰¹é‡åˆ†æçš„å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œé€šè¿‡`DataSourceManager`å’Œ`DataConsistencyChecker`æ„å»ºäº†å¥å£®çš„å¤šæ•°æ®æºfallbackå’Œä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶ï¼Œå¹¶é€šè¿‡`RateLimiter`æœ‰æ•ˆç®¡ç†äº†Tushareã€AKShareç­‰æ•°æ®æºçš„é™æµé—®é¢˜ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æä¾›çš„APIå’Œè„šæœ¬éªŒè¯åŒæ­¥çŠ¶æ€ã€è¯Šæ–­æ•°æ®å®Œæ•´æ€§å¹¶æ‰§è¡Œæ‰‹åŠ¨åŒæ­¥æ“ä½œï¼Œç¡®ä¿ç³»ç»Ÿæ•°æ®çš„å‡†ç¡®æ€§å’ŒåŠæ—¶æ€§ã€‚