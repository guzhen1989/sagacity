# é…ç½®ç®¡ç†ç»„ä»¶

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**  
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue)
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue)
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue)
- [LLMConfigDialog.vue](file://frontend/src/views/Settings/components/LLMConfigDialog.vue)
- [config.py](file://app/routers/config.py)
- [config.py](file://app/models/config.py)
- [CONFIG_WIZARD.md](file://docs/features/config-wizard/CONFIG_WIZARD.md)
- [modelCapabilities.ts](file://frontend/src/api/modelCapabilities.ts)
- [config.ts](file://frontend/src/api/config.ts)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é…ç½®å‘å¯¼ç»„ä»¶ (ConfigWizard)](#é…ç½®å‘å¯¼ç»„ä»¶-configwizard)
3. [æ¨¡å‹é…ç½®ç»„ä»¶ (ModelConfig)](#æ¨¡å‹é…ç½®ç»„ä»¶-modelconfig)
4. [æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨ (DeepModelSelector)](#æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨-deepmodelselector)
5. [çŠ¶æ€ç®¡ç†ä¸è¡¨å•éªŒè¯](#çŠ¶æ€ç®¡ç†ä¸è¡¨å•éªŒè¯)
6. [åç«¯APIäº¤äº’](#åç«¯apiäº¤äº’)
7. [é…ç½®ä¿å­˜ä¸åŠ è½½æµç¨‹](#é…ç½®ä¿å­˜ä¸åŠ è½½æµç¨‹)
8. [å¸¸è§é…ç½®é—®é¢˜è§£å†³æ–¹æ¡ˆ](#å¸¸è§é…ç½®é—®é¢˜è§£å†³æ–¹æ¡ˆ)
9. [æ€»ç»“](#æ€»ç»“)

## ç®€ä»‹
é…ç½®ç®¡ç†ç»„ä»¶æ˜¯ç³»ç»Ÿåˆå§‹åŒ–å’Œè¿è¡Œçš„æ ¸å¿ƒéƒ¨åˆ†ï¼ŒåŒ…å«ä¸‰ä¸ªä¸»è¦ç»„ä»¶ï¼š**é…ç½®å‘å¯¼ (ConfigWizard)**ã€**æ¨¡å‹é…ç½® (ModelConfig)** å’Œ **æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨ (DeepModelSelector)**ã€‚è¿™äº›ç»„ä»¶ååŒå·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›ç›´è§‚çš„é…ç½®ç•Œé¢ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®è¿æ¥æ•°æ®åº“ã€å¤§æ¨¡å‹æœåŠ¡å’Œæ•°æ®æºã€‚

é…ç½®å‘å¯¼å¼•å¯¼æ–°ç”¨æˆ·å®Œæˆç³»ç»Ÿåˆå§‹åŒ–é…ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€å¤§æ¨¡å‹æä¾›å•†ã€APIå¯†é’¥å’Œæ•°æ®æºç­‰å…³é”®è®¾ç½®ã€‚æ¨¡å‹é…ç½®ç»„ä»¶æä¾›å¤šæ¨¡å‹ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒå¿«é€Ÿåˆ†æå’Œæ·±åº¦å†³ç­–æ¨¡å‹çš„ç‹¬ç«‹é…ç½®ã€‚æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨åˆ™ä¸ºé«˜çº§ç”¨æˆ·æä¾›æ¨¡å‹é€‰æ‹©åŠŸèƒ½ï¼Œæ”¯æŒèƒ½åŠ›ç­‰çº§å’Œè§’è‰²æ ‡ç­¾çš„å¯è§†åŒ–å±•ç¤ºã€‚

**Section sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue)
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue)
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue)

## é…ç½®å‘å¯¼ç»„ä»¶ (ConfigWizard)

é…ç½®å‘å¯¼æ˜¯ä¸€ä¸ªå‘å¯¼å¼å¯¹è¯æ¡†ç»„ä»¶ï¼Œé€šè¿‡äº”ä¸ªæ­¥éª¤å¼•å¯¼ç”¨æˆ·å®Œæˆç³»ç»Ÿåˆå§‹åŒ–é…ç½®ã€‚è¯¥ç»„ä»¶ä½¿ç”¨Element Plusçš„`el-dialog`å’Œ`el-steps`ç»„ä»¶æ„å»ºï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿé€æ­¥å®Œæˆé…ç½®ã€‚

### é…ç½®å‘å¯¼å·¥ä½œæµç¨‹
```mermaid
graph TD
A[æ¬¢è¿ç•Œé¢] --> B[æ•°æ®åº“é…ç½®]
B --> C[å¤§æ¨¡å‹é…ç½®]
C --> D[æ•°æ®æºé…ç½®]
D --> E[å®Œæˆé…ç½®]
```

**Diagram sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L1-L599)

### é…ç½®å‘å¯¼æ•°æ®ç»“æ„
é…ç½®å‘å¯¼ç»´æŠ¤ä¸€ä¸ª`WizardData`ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼š

```typescript
interface WizardData {
  mongodb: {
    host: string
    port: number
    database: string
  }
  redis: {
    host: string
    port: number
  }
  llm: {
    provider: string
    apiKey: string
    modelName: string
  }
  datasource: {
    type: string
    token: string
    apiKey: string
  }
}
```

**Diagram sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L327-L349)

### é…ç½®å‘å¯¼æ­¥éª¤è¯¦è§£

#### æ­¥éª¤0ï¼šæ¬¢è¿ç•Œé¢
æ¬¢è¿ç•Œé¢æ˜¯é…ç½®å‘å¯¼çš„å…¥å£ï¼Œå‘ç”¨æˆ·ä»‹ç»é…ç½®å‘å¯¼çš„ç›®çš„å’ŒåŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©"è·³è¿‡å‘å¯¼"æˆ–"å¼€å§‹é…ç½®"ã€‚

#### æ­¥éª¤1ï¼šæ•°æ®åº“é…ç½®
æ­¤æ­¥éª¤è¦æ±‚ç”¨æˆ·é…ç½®MongoDBå’ŒRedisæ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›é…ç½®ä¸»è¦ç”¨äºéªŒè¯è¿æ¥ï¼Œå®é™…çš„æ•°æ®åº“é…ç½®éœ€è¦åœ¨`.env`æ–‡ä»¶ä¸­è®¾ç½®ã€‚

#### æ­¥éª¤2ï¼šå¤§æ¨¡å‹é…ç½®
ç”¨æˆ·åœ¨æ­¤æ­¥éª¤é€‰æ‹©å¤§æ¨¡å‹æä¾›å•†ï¼ˆå¦‚DeepSeekã€é€šä¹‰åƒé—®ã€OpenAIã€Google Geminiï¼‰ï¼Œå¹¶è¾“å…¥ç›¸åº”çš„APIå¯†é’¥ã€‚ç»„ä»¶ä¼šæ ¹æ®é€‰æ‹©çš„æä¾›å•†åŠ¨æ€æ›´æ–°å¯ç”¨æ¨¡å‹åˆ—è¡¨ã€‚

#### æ­¥éª¤3ï¼šæ•°æ®æºé…ç½®
ç”¨æˆ·é€‰æ‹©è‚¡ç¥¨æ•°æ®æºï¼ŒåŒ…æ‹¬AKShareï¼ˆæ¨èï¼Œå…è´¹æ— éœ€å¯†é’¥ï¼‰ã€Tushareï¼ˆä¸“ä¸šAè‚¡æ•°æ®ï¼‰å’ŒFinnHubï¼ˆç¾è‚¡æ•°æ®ï¼‰ã€‚å¯¹äºéœ€è¦å¯†é’¥çš„æ•°æ®æºï¼Œç”¨æˆ·éœ€è¦è¾“å…¥ç›¸åº”çš„Tokenæˆ–API Keyã€‚

#### æ­¥éª¤4ï¼šå®Œæˆé…ç½®
æœ€åä¸€æ­¥æ˜¾ç¤ºé…ç½®æ‘˜è¦ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€å¤§æ¨¡å‹å’Œæ•°æ®æºçš„é…ç½®ä¿¡æ¯ï¼Œå¹¶æä¾›ä¸‹ä¸€æ­¥æ“ä½œå»ºè®®ã€‚

**Section sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L1-L599)
- [CONFIG_WIZARD.md](file://docs/features/config-wizard/CONFIG_WIZARD.md#L197-L284)

## æ¨¡å‹é…ç½®ç»„ä»¶ (ModelConfig)

æ¨¡å‹é…ç½®ç»„ä»¶æä¾›æ¨¡å‹å‚æ•°çš„å¯è§†åŒ–ç¼–è¾‘ç•Œé¢ï¼Œæ”¯æŒå¤šæ¨¡å‹é…ç½®ç®¡ç†ã€‚è¯¥ç»„ä»¶å…è®¸ç”¨æˆ·åˆ†åˆ«ä¸ºå¿«é€Ÿåˆ†æå’Œæ·±åº¦å†³ç­–é…ç½®ä¸åŒçš„æ¨¡å‹ã€‚

### æ¨¡å‹é…ç½®ç•Œé¢ç»“æ„
```mermaid
graph TD
A[AIæ¨¡å‹é…ç½®] --> B[å¿«é€Ÿåˆ†ææ¨¡å‹]
A --> C[æ·±åº¦å†³ç­–æ¨¡å‹]
A --> D[æ¨¡å‹æ¨èæç¤º]
```

**Diagram sources**
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue#L1-L371)

### æ¨¡å‹é…ç½®åŠŸèƒ½ç‰¹æ€§

#### æ¨¡å‹é€‰æ‹©ä¸æ˜¾ç¤º
ç»„ä»¶ä½¿ç”¨`el-select`ç»„ä»¶æä¾›æ¨¡å‹é€‰æ‹©åŠŸèƒ½ï¼Œæ¯ä¸ªé€‰é¡¹éƒ½åŒ…å«æ¨¡å‹åç§°ã€èƒ½åŠ›ç­‰çº§å¾½ç« ã€è§’è‰²æ ‡ç­¾å’Œæä¾›å•†ä¿¡æ¯ã€‚

```vue
<el-option>
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 8px;">
    <span style="flex: 1;">{{ model.model_display_name || model.model_name }}</span>
    <div style="display: flex; align-items: center; gap: 4px;">
      <!-- èƒ½åŠ›ç­‰çº§å¾½ç«  -->
      <el-tag v-if="model.capability_level" :type="getCapabilityTagType(model.capability_level)" size="small" effect="plain">
        {{ getCapabilityText(model.capability_level) }}
      </el-tag>
      <!-- è§’è‰²æ ‡ç­¾ -->
      <el-tag v-if="isQuickAnalysisRole(model.suitable_roles)" type="success" size="small" effect="plain">âš¡å¿«é€Ÿ</el-tag>
      <span style="font-size: 12px; color: #909399;">{{ model.provider }}</span>
    </div>
  </div>
</el-option>
```

**Diagram sources**
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue#L15-L46)

#### æ¨¡å‹èƒ½åŠ›ç­‰çº§ç³»ç»Ÿ
ç»„ä»¶å®ç°äº†äº”çº§æ¨¡å‹èƒ½åŠ›ç­‰çº§ç³»ç»Ÿï¼Œç”¨äºåŒºåˆ†ä¸åŒæ¨¡å‹çš„æ€§èƒ½å’Œé€‚ç”¨åœºæ™¯ï¼š

| ç­‰çº§ | åç§° | æè¿° |
|------|------|------|
| 1 | âš¡åŸºç¡€ | é€‚åˆå¿«é€Ÿåˆ†æå’Œç®€å•ä»»åŠ¡ |
| 2 | ğŸ“Šæ ‡å‡† | é€‚åˆæ—¥å¸¸åˆ†æå’Œå¸¸è§„ä»»åŠ¡ |
| 3 | ğŸ¯é«˜çº§ | é€‚åˆæ·±åº¦åˆ†æå’Œå¤æ‚æ¨ç† |
| 4 | ğŸ”¥ä¸“ä¸š | é€‚åˆä¸“ä¸šçº§åˆ†æå’Œå¤šè½®è¾©è®º |
| 5 | ğŸ‘‘æ——èˆ° | æœ€å¼ºèƒ½åŠ›ï¼Œé€‚åˆå…¨é¢åˆ†æ |

**Diagram sources**
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue#L177-L184)

#### æ¨¡å‹æ¨èåŠŸèƒ½
ç»„ä»¶é›†æˆäº†æ¨¡å‹æ¨èåŠŸèƒ½ï¼Œæ ¹æ®ç”¨æˆ·çš„åˆ†ææ·±åº¦è‡ªåŠ¨æ¨èåˆé€‚çš„æ¨¡å‹é…ç½®ã€‚å½“åˆ†ææ·±åº¦æˆ–æ¨¡å‹é€‰æ‹©å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç³»ç»Ÿä¼šé‡æ–°è¯„ä¼°æ¨¡å‹é€‚é…æ€§å¹¶æä¾›æ¨èã€‚

```mermaid
sequenceDiagram
participant User as ç”¨æˆ·
participant ModelConfig as æ¨¡å‹é…ç½®ç»„ä»¶
participant API as modelCapabilities API
User->>ModelConfig : æ›´æ”¹åˆ†ææ·±åº¦
ModelConfig->>API : è°ƒç”¨recommendModels(depthName)
API-->>ModelConfig : è¿”å›æ¨èæ¨¡å‹
ModelConfig->>User : æ˜¾ç¤ºæ¨èæç¤ºå’Œ"åº”ç”¨æ¨è"æŒ‰é’®
```

**Diagram sources**
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue#L217-L289)
- [modelCapabilities.ts](file://frontend/src/api/modelCapabilities.ts)

**Section sources**
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue#L1-L371)
- [LLMConfigDialog.vue](file://frontend/src/views/Settings/components/LLMConfigDialog.vue#L213-L336)

## æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨ (DeepModelSelector)

æ·±åº¦æ¨¡å‹é€‰æ‹©å™¨æ˜¯ä¸€ä¸ªå¯å¤ç”¨çš„æ¨¡å‹é€‰æ‹©ç»„ä»¶ï¼Œæä¾›é«˜çº§æ¨¡å‹é€‰æ‹©åŠŸèƒ½ã€‚è¯¥ç»„ä»¶æ”¯æŒæ ¹æ®æ¨¡å‹èƒ½åŠ›å’Œè§’è‰²è¿›è¡Œç­›é€‰å’Œæ˜¾ç¤ºã€‚

### ç»„ä»¶å±æ€§ä¸é…ç½®
```typescript
interface Props {
  modelValue: string
  availableModels: any[]
  placeholder?: string
  type?: 'quick' | 'deep'
  size?: 'large' | 'default' | 'small'
  width?: string
}
```

**Diagram sources**
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue#L45-L52)

### æ¨¡å‹é€‰é¡¹æ¸²æŸ“
ç»„ä»¶ä¸ºæ¯ä¸ªæ¨¡å‹é€‰é¡¹æ¸²æŸ“ä¸°å¯Œçš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¨¡å‹åç§°ã€èƒ½åŠ›ç­‰çº§å¾½ç« ã€è§’è‰²æ ‡ç­¾å’Œæä¾›å•†ã€‚

```mermaid
graph TD
A[æ¨¡å‹é€‰é¡¹] --> B[æ¨¡å‹åç§°]
A --> C[èƒ½åŠ›ç­‰çº§å¾½ç« ]
A --> D[è§’è‰²æ ‡ç­¾]
A --> E[æä¾›å•†]
```

**Diagram sources**
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue#L16-L37)

### èƒ½åŠ›ç­‰çº§ä¸è§’è‰²åˆ¤æ–­
ç»„ä»¶å®ç°äº†èƒ½åŠ›ç­‰çº§å’Œè§’è‰²çš„åˆ¤æ–­é€»è¾‘ï¼Œç”¨äºå†³å®šæ˜¯å¦æ˜¾ç¤ºç›¸åº”çš„æ ‡ç­¾ã€‚

```typescript
const getCapabilityText = (level: number): string => {
  const texts: Record<number, string> = {
    1: 'âš¡åŸºç¡€',
    2: 'ğŸ“Šæ ‡å‡†',
    3: 'ğŸ¯é«˜çº§',
    4: 'ğŸ”¥ä¸“ä¸š',
    5: 'ğŸ‘‘æ——èˆ°'
  }
  return texts[level] || 'ğŸ“Šæ ‡å‡†'
}

const isQuickAnalysisRole = (roles: string[] | undefined): boolean => {
  if (!roles || !Array.isArray(roles)) return false
  return roles.includes('quick_analysis') || roles.includes('both')
}

const isDeepAnalysisRole = (roles: string[] | undefined): boolean => {
  if (!roles || !Array.isArray(roles)) return false
  return roles.includes('deep_analysis') || roles.includes('both')
}
```

**Diagram sources**
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue#L73-L98)

**Section sources**
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue#L1-L100)

## çŠ¶æ€ç®¡ç†ä¸è¡¨å•éªŒè¯

é…ç½®ç®¡ç†ç»„ä»¶é‡‡ç”¨Vue 3çš„Composition APIè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œä½¿ç”¨`ref`å’Œ`computed`åˆ›å»ºå“åº”å¼æ•°æ®ã€‚

### è®¡ç®—å±æ€§åŒå‘ç»‘å®š
ä¸ºäº†å®ç°å®‰å…¨çš„åŒå‘ç»‘å®šï¼Œç»„ä»¶ä½¿ç”¨è®¡ç®—å±æ€§çš„getterå’Œsetteræ¨¡å¼ï¼š

```typescript
const datasourceType = computed({
  get: () => wizardData.value.datasource.type,
  set: (value: string) => {
    wizardData.value.datasource.type = value
  }
})
```

**Diagram sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L422-L427)

### è¡¨å•éªŒè¯é€»è¾‘
ç»„ä»¶åœ¨æäº¤é…ç½®å‰è¿›è¡ŒåŸºæœ¬çš„è¡¨å•éªŒè¯ï¼Œç¡®ä¿å¿…å¡«å­—æ®µå·²å¡«å†™ã€‚

```typescript
const handleNext = async () => {
  // éªŒè¯å½“å‰æ­¥éª¤
  if (currentStep.value === 2 && !wizardData.value.llm.provider) {
    ElMessage.warning('è¯·é€‰æ‹©å¤§æ¨¡å‹æä¾›å•†')
    return
  }
  
  if (currentStep.value === 2 && !wizardData.value.llm.apiKey) {
    ElMessage.warning('è¯·è¾“å…¥ API å¯†é’¥')
    return
  }
  
  currentStep.value++
}
```

**Diagram sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L490-L502)

### æ¨¡å‹é…ç½®éªŒè¯
åœ¨æ¨¡å‹é…ç½®å¯¹è¯æ¡†ä¸­ï¼Œç»„ä»¶ä½¿ç”¨Element Plusçš„è¡¨å•éªŒè¯è§„åˆ™è¿›è¡Œæ›´ä¸¥æ ¼çš„éªŒè¯ï¼š

```typescript
const rules: FormRules = {
  provider: [{ required: true, message: 'è¯·é€‰æ‹©ä¾›åº”å•†', trigger: 'change' }],
  model_name: [{ required: true, message: 'è¯·è¾“å…¥æ¨¡å‹åç§°', trigger: 'blur' }],
  max_tokens: [{ required: true, message: 'è¯·è¾“å…¥æœ€å¤§Tokenæ•°', trigger: 'blur' }],
  temperature: [{ required: true, message: 'è¯·è¾“å…¥æ¸©åº¦å‚æ•°', trigger: 'blur' }],
  timeout: [{ required: true, message: 'è¯·è¾“å…¥è¶…æ—¶æ—¶é—´', trigger: 'blur' }],
  retry_times: [{ required: true, message: 'è¯·è¾“å…¥é‡è¯•æ¬¡æ•°', trigger: 'blur' }],
  priority: [{ required: true, message: 'è¯·è¾“å…¥ä¼˜å…ˆçº§', trigger: 'blur' }]
}
```

**Diagram sources**
- [LLMConfigDialog.vue](file://frontend/src/views/Settings/components/LLMConfigDialog.vue#L419-L427)

**Section sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue#L490-L502)
- [LLMConfigDialog.vue](file://frontend/src/views/Settings/components/LLMConfigDialog.vue#L419-L427)

## åç«¯APIäº¤äº’

é…ç½®ç®¡ç†ç»„ä»¶ä¸åç«¯`config` APIè¿›è¡Œäº¤äº’ï¼Œå®ç°é…ç½®çš„ä¿å­˜ã€åŠ è½½å’ŒéªŒè¯ã€‚

### APIç«¯ç‚¹æ¦‚è§ˆ
```mermaid
graph TD
A[å‰ç«¯ç»„ä»¶] --> B[config API]
B --> C[/config/system]
B --> D[/config/llm/providers]
B --> E[/config/llm]
B --> F[/config/datasource]
B --> G[/config/database]
B --> H[/config/reload]
```

**Diagram sources**
- [config.py](file://app/routers/config.py#L31-L80)

### é…ç½®è·å–æµç¨‹
```mermaid
sequenceDiagram
participant Frontend as å‰ç«¯
participant Backend as åç«¯
participant DB as æ•°æ®åº“
Frontend->>Backend : GET /api/system/config
Backend->>DB : æŸ¥è¯¢ç³»ç»Ÿé…ç½®
DB-->>Backend : è¿”å›é…ç½®æ•°æ®
Backend->>Backend : è„±æ•æ•æ„Ÿä¿¡æ¯
Backend-->>Frontend : è¿”å›è„±æ•åçš„é…ç½®
Frontend->>Frontend : æ˜¾ç¤ºé…ç½®ä¿¡æ¯
```

**Diagram sources**
- [config.py](file://app/routers/config.py#L171-L197)

### é…ç½®æ›´æ–°æµç¨‹
```mermaid
sequenceDiagram
participant Frontend as å‰ç«¯
participant Backend as åç«¯
participant DB as æ•°æ®åº“
Frontend->>Backend : POST /api/system/config/llm
Backend->>Backend : éªŒè¯é…ç½®æ•°æ®
Backend->>Backend : å¤„ç†APIå¯†é’¥é€»è¾‘
Backend->>DB : ä¿å­˜é…ç½®
DB-->>Backend : è¿”å›ç»“æœ
Backend->>Backend : åŒæ­¥å®šä»·é…ç½®
Backend->>Backend : è®°å½•æ“ä½œæ—¥å¿—
Backend-->>Frontend : è¿”å›æˆåŠŸå“åº”
```

**Diagram sources**
- [config.py](file://app/routers/config.py#L582-L688)

### æ•æ„Ÿä¿¡æ¯å¤„ç†
åç«¯APIå¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†ï¼Œç¡®ä¿APIå¯†é’¥ç­‰æ•æ„Ÿä¿¡æ¯ä¸ä¼šç›´æ¥æš´éœ²ç»™å‰ç«¯ã€‚

```python
def _sanitize_llm_configs(items):
    try:
        return [LLMConfig(**{**i.model_dump(), "api_key": None}) for i in items]
    except Exception:
        return items

def _sanitize_datasource_configs(items):
    """
    è„±æ•æ•°æ®æºé…ç½®ï¼Œè¿”å›ç¼©ç•¥çš„ API Key
    """
    try:
        from app.utils.api_key_utils import (
            is_valid_api_key,
            truncate_api_key,
            get_env_api_key_for_datasource
        )
        
        result = []
        for item in items:
            data = item.model_dump()
            
            # å¤„ç† API Key
            db_key = data.get("api_key")
            if is_valid_api_key(db_key):
                data["api_key"] = truncate_api_key(db_key)
            else:
                ds_type = data.get("type")
                if isinstance(ds_type, str):
                    env_key = get_env_api_key_for_datasource(ds_type)
                    if env_key:
                        data["api_key"] = truncate_api_key(env_key)
                    else:
                        data["api_key"] = None
                else:
                    data["api_key"] = None
            
            result.append(DataSourceConfig(**data))
        return result
    except Exception as e:
        print(f"âš ï¸ è„±æ•æ•°æ®æºé…ç½®å¤±è´¥: {e}")
        return items
```

**Diagram sources**
- [config.py](file://app/routers/config.py#L83-L139)

**Section sources**
- [config.py](file://app/routers/config.py#L83-L139)
- [config.py](file://app/routers/config.py#L207-L271)

## é…ç½®ä¿å­˜ä¸åŠ è½½æµç¨‹

### é…ç½®ä¿å­˜æµç¨‹
å½“ç”¨æˆ·å®Œæˆé…ç½®å‘å¯¼æˆ–åœ¨é…ç½®ç®¡ç†é¡µé¢ä¿®æ”¹é…ç½®æ—¶ï¼Œç³»ç»Ÿä¼šæ‰§è¡Œä»¥ä¸‹ä¿å­˜æµç¨‹ï¼š

1. å‰ç«¯æ”¶é›†é…ç½®æ•°æ®
2. å‰ç«¯éªŒè¯é…ç½®æ•°æ®
3. å‰ç«¯è°ƒç”¨åç«¯APIä¿å­˜é…ç½®
4. åç«¯éªŒè¯å¹¶å¤„ç†é…ç½®æ•°æ®
5. åç«¯ä¿å­˜é…ç½®åˆ°æ•°æ®åº“
6. åç«¯é‡æ–°åŠ è½½é…ç½®
7. åç«¯è¿”å›æˆåŠŸå“åº”

### é…ç½®åŠ è½½æµç¨‹
ç³»ç»Ÿå¯åŠ¨æˆ–ç”¨æˆ·è®¿é—®é…ç½®ç®¡ç†é¡µé¢æ—¶ï¼Œä¼šæ‰§è¡Œä»¥ä¸‹åŠ è½½æµç¨‹ï¼š

1. å‰ç«¯è°ƒç”¨`/api/system/config` API
2. åç«¯ä»æ•°æ®åº“æŸ¥è¯¢ç³»ç»Ÿé…ç½®
3. åç«¯å¯¹æ•æ„Ÿä¿¡æ¯è¿›è¡Œè„±æ•å¤„ç†
4. åç«¯è¿”å›é…ç½®æ•°æ®
5. å‰ç«¯æ¥æ”¶å¹¶æ˜¾ç¤ºé…ç½®ä¿¡æ¯

### é…ç½®é‡è½½æœºåˆ¶
å½“é…ç½®æ›´æ–°åï¼Œç³»ç»Ÿéœ€è¦é‡æ–°åŠ è½½é…ç½®ä»¥ä½¿å…¶ç”Ÿæ•ˆã€‚è¿™é€šè¿‡è°ƒç”¨`/api/system/config/reload`ç«¯ç‚¹å®ç°ã€‚

```python
@router.post("/reload", summary="é‡æ–°åŠ è½½é…ç½®")
async def reload_config(current_user: dict = Depends(get_current_user)):
    """
    é‡æ–°åŠ è½½é…ç½®å¹¶æ¡¥æ¥åˆ°ç¯å¢ƒå˜é‡
    
    ç”¨äºé…ç½®æ›´æ–°åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡
    """
    try:
        from app.core.config_bridge import reload_bridged_config
        
        success = reload_bridged_config()
        
        if success:
            await log_operation(
                user_id=str(current_user.get("user_id", "")),
                username=current_user.get("username", "unknown"),
                action_type=ActionType.CONFIG_MANAGEMENT,
                action="é‡è½½é…ç½®",
                details={"action": "reload_config"},
                ip_address="",
                user_agent=""
            )
            
            return {
                "success": True,
                "message": "é…ç½®é‡è½½æˆåŠŸ",
                "data": {
                    "reloaded_at": now_tz().isoformat()
                }
            }
        else:
            return {
                "success": False,
                "message": "é…ç½®é‡è½½å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—"
            }
    except Exception as e:
        logger.error(f"é…ç½®é‡è½½å¤±è´¥: {e}", exc_info=True)
        raise HTTPException(
            status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,
            detail=f"é…ç½®é‡è½½å¤±è´¥: {str(e)}"
        )
```

**Diagram sources**
- [config.py](file://app/routers/config.py#L37-L77)

**Section sources**
- [config.py](file://app/routers/config.py#L37-L77)

## å¸¸è§é…ç½®é—®é¢˜è§£å†³æ–¹æ¡ˆ

### é…ç½®å‘å¯¼æ²¡æœ‰è‡ªåŠ¨å¼¹å‡º
**æ£€æŸ¥æ¸…å•**:
1. ç¡®è®¤å·²ç™»å½•
2. æ£€æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰ `config_wizard_completed` æ ‡è®°
3. æ£€æŸ¥åç«¯ `/api/system/config/validate` API æ˜¯å¦æ­£å¸¸
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯

### APIå¯†é’¥éªŒè¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤å¯†é’¥æ ¼å¼æ­£ç¡®ï¼Œé•¿åº¦å¤§äº10ä¸ªå­—ç¬¦
2. ç¡®ä¿å¯†é’¥ä¸æ˜¯å ä½ç¬¦ï¼ˆå¦‚"your_xxx"ï¼‰
3. æ£€æŸ¥å¯†é’¥æ˜¯å¦å·²è¿‡æœŸ
4. å°è¯•åœ¨"å‚å®¶ç®¡ç†"ä¸­æµ‹è¯•APIå¯†é’¥

### æ•°æ®æºé…ç½®ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æ•°æ®æºå·²å¯ç”¨
2. æ£€æŸ¥æ•°æ®æºä¼˜å…ˆçº§è®¾ç½®
3. éªŒè¯APIå¯†é’¥æˆ–Tokenæ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸

### æ¨¡å‹é…ç½®æ— æ³•ä¿å­˜
**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æ‰€æœ‰å¿…å¡«å­—æ®µå·²å¡«å†™
2. æ£€æŸ¥æ¨¡å‹åç§°æ˜¯å¦æ­£ç¡®
3. ç¡®è®¤æä¾›å•†é…ç½®å·²æ­£ç¡®è®¾ç½®
4. æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

**Section sources**
- [CONFIG_WIZARD.md](file://docs/features/config-wizard/CONFIG_WIZARD.md#L277-L284)

## æ€»ç»“
é…ç½®ç®¡ç†ç»„ä»¶ä¸ºç³»ç»Ÿæä¾›äº†å®Œæ•´çš„é…ç½®è§£å†³æ–¹æ¡ˆï¼Œä»åˆå§‹åŒ–é…ç½®åˆ°é«˜çº§æ¨¡å‹ç®¡ç†ï¼Œç¡®ä¿ç”¨æˆ·èƒ½å¤Ÿè½»æ¾åœ°é…ç½®å’Œç®¡ç†ç³»ç»Ÿã€‚é€šè¿‡å‘å¯¼å¼ç•Œé¢ã€å¯è§†åŒ–ç¼–è¾‘å’Œæ™ºèƒ½æ¨èï¼Œå¤§å¤§é™ä½äº†ç”¨æˆ·çš„é…ç½®éš¾åº¦ã€‚

ç»„ä»¶è®¾è®¡éµå¾ªäº†è‰¯å¥½çš„æ¶æ„åŸåˆ™ï¼Œå‰ç«¯ä¸åç«¯åˆ†ç¦»ï¼Œæ•æ„Ÿä¿¡æ¯å¾—åˆ°å¦¥å–„å¤„ç†ï¼Œé…ç½®å˜æ›´èƒ½å¤Ÿå®æ—¶ç”Ÿæ•ˆã€‚æœªæ¥å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå¦‚å¢åŠ é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½ã€æä¾›æ›´è¯¦ç»†çš„é…ç½®éªŒè¯åé¦ˆç­‰ã€‚

**Section sources**
- [ConfigWizard.vue](file://frontend/src/components/ConfigWizard.vue)
- [ModelConfig.vue](file://frontend/src/components/ModelConfig.vue)
- [DeepModelSelector.vue](file://frontend/src/components/DeepModelSelector.vue)
- [config.py](file://app/routers/config.py)
- [config.py](file://app/models/config.py)