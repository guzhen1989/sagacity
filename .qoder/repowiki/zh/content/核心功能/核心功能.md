# 核心功能

<cite>
**本文档引用的文件**   
- [main.py](file://app/main.py)
- [analysis.py](file://app/routers/analysis.py)
- [analysis_service.py](file://app/services/analysis_service.py)
- [simple_analysis_service.py](file://app/services/simple_analysis_service.py)
- [screening.py](file://app/routers/screening.py)
- [screening_service.py](file://app/services/screening_service.py)
- [enhanced_screening_service.py](file://app/services/enhanced_screening_service.py)
- [favorites.py](file://app/routers/favorites.py)
- [favorites_service.py](file://app/services/favorites_service.py)
- [paper.py](file://app/routers/paper.py)
- [stock_models.py](file://app/models/stock_models.py)
- [analysis.py](file://app/models/analysis.py)
- [screening.py](file://app/models/screening.py)
</cite>

## 目录
1. [多智能体股票分析系统](#多智能体股票分析系统)
2. [批量分析功能](#批量分析功能)
3. [智能股票筛选器](#智能股票筛选器)
4. [模拟交易系统](#模拟交易系统)
5. [自选股管理](#自选股管理)
6. [个股详情页](#个股详情页)

## 多智能体股票分析系统

sagacity平台的核心是其多智能体股票分析系统，该系统通过多个专业智能体的分工协作来完成全面的股票分析。系统主要包含市场分析师、基本面分析师和新闻分析师等不同角色，每个智能体负责特定领域的分析任务。

市场分析师（Market Analyst）专注于技术分析，利用各种技术指标如移动平均线、相对强弱指数（RSI）、KDJ指标和MACD等，对股票的价格走势和交易量进行分析，判断市场趋势和买卖时机。该智能体能够识别技术形态，如向上穿越和向下穿越等信号。

基本面分析师（Fundamentals Analyst）则深入研究公司的财务状况，分析关键财务指标，包括市盈率（PE）、市净率（PB）、净资产收益率（ROE）、总市值和流通市值等。通过评估公司的盈利能力、估值水平和成长性，为投资决策提供依据。

新闻分析师（News Analyst）负责处理和分析与股票相关的新闻和社交媒体信息。该智能体能够从海量的新闻数据中提取关键信息，进行情感分析，判断市场情绪是积极、消极还是中性，从而评估新闻事件对股价的潜在影响。

这些智能体并非孤立工作，而是通过一个协同的分析流程进行协作。系统支持不同级别的研究深度，从“快速”到“全面”共五个等级。在“标准”和“深度”分析模式下，系统会启动研究团队辩论机制，让多头研究员和空头研究员就股票的前景进行多轮辩论，最终由研究经理做出综合判断。同时，风险管理团队也会进行独立的风险评估，确保投资决策的稳健性。整个分析过程由TradingAgentsGraph协调，最终生成包含摘要、投资建议、置信度、风险等级和关键要点的综合性分析报告。

**Section sources**
- [main.py](file://app/main.py#L215-L579)
- [analysis.py](file://app/routers/analysis.py#L6-800)
- [analysis_service.py](file://app/services/analysis_service.py#L1-L800)
- [simple_analysis_service.py](file://app/services/simple_analysis_service.py#L1-L800)
- [analysis.py](file://app/models/analysis.py#L1-L237)

## 批量分析功能

批量分析功能允许用户一次性对多只股票进行分析，极大地提高了分析效率。用户可以通过API或前端界面提交一个包含多只股票代码的分析批次请求。

该功能的使用方法非常简单。用户需要指定一个批次标题，并提供一个股票代码列表（最多支持10只股票）。同时，用户可以为整个批次配置统一的分析参数，例如研究深度（快速、基础、标准、深度、全面）、选中的分析师类型（市场、基本面、新闻、社交）以及自定义提示词等。提交请求后，系统会为批次中的每只股票创建一个独立的分析任务。

在性能方面，批量分析功能采用了先进的队列服务（QueueService）和并发执行机制。系统通过Redis实现任务队列，确保任务的可靠性和顺序性。分析任务在后台由工作线程池异步执行，支持真正的并发处理，而不是串行执行。系统还实现了进度跟踪和状态管理，用户可以实时查询每个任务的进度和最终结果。为了优化资源使用，系统支持配置用户和全局的并发任务限制，防止服务器过载。

**Section sources**
- [analysis.py](file://app/routers/analysis.py#L771-L800)
- [analysis_service.py](file://app/services/analysis_service.py#L514-L614)
- [analysis.py](file://app/models/analysis.py#L106-L137)

## 智能股票筛选器

智能股票筛选器是平台提供的一项强大工具，允许用户根据多种条件对股票池进行筛选，快速发现符合特定投资策略的股票。

其实现机制基于一个灵活的筛选服务（ScreeningService）。用户通过API提交一个包含多个筛选条件的请求。每个筛选条件由字段名、操作符（如大于、小于、等于、区间等）和值组成。系统支持的筛选字段非常丰富，涵盖了基础信息（如股票代码、名称、行业）、财务指标（如PE、PB、ROE、总市值）和技术指标（如换手率、量比、20日均线）等多个维度。

筛选器的配置选项非常直观。用户可以通过API获取所有支持的字段及其详细信息，包括字段的显示名称、数据类型、单位和可支持的操作符。筛选条件可以组合使用，并支持排序和分页功能。此外，系统还提供了增强的筛选服务（EnhancedScreeningService），它能够自动选择最优的筛选策略，例如利用数据库的索引进行优化查询，从而显著提升筛选性能，尤其是在处理大量数据时。

**Section sources**
- [screening.py](file://app/routers/screening.py#L1-L379)
- [screening_service.py](file://app/services/screening_service.py)
- [enhanced_screening_service.py](file://app/services/enhanced_screening_service.py)
- [screening.py](file://app/models/screening.py#L1-L347)

## 模拟交易系统

模拟交易系统为用户提供了一个无风险的环境，用于测试投资策略和验证分析结果。

该系统的主要功能包括：创建和管理模拟账户、提交买卖订单、查看持仓和交易记录。系统支持多市场（A股、港股、美股）和多货币（人民币、港币、美元）的模拟交易。当用户提交一个市价单时，系统会根据当前的实时行情价格即时成交，并自动更新账户资金和持仓。

使用场景非常广泛。用户可以在对一只股票进行深度分析后，根据分析报告中的投资建议，直接在模拟交易系统中下单，以验证该建议的有效性。投资者可以利用该系统测试不同的交易策略，例如网格交易、趋势跟踪等，而无需承担真实资金的风险。系统还支持重置账户功能，方便用户进行多次独立的测试。

**Section sources**
- [paper.py](file://app/routers/paper.py#L1-L585)

## 自选股管理

自选股管理功能允许用户将感兴趣的股票添加到个人收藏夹中，方便集中跟踪和管理。

用户可以通过API将股票添加到自选股列表，同时可以为每只股票添加标签（如“科技”、“消费”）和备注信息。系统提供了完整的CRUD（创建、读取、更新、删除）接口，支持对自选股进行增删改查操作。用户可以按标签对自选股进行分类和筛选。

此外，系统还集成了实时行情同步功能。用户可以手动触发或系统定时自动同步所有自选股的最新行情数据，确保用户在查看自选股列表时，能够看到最新的股价、涨跌幅和成交量等信息。这使得自选股列表不仅仅是一个静态的收藏夹，更是一个动态的监控面板。

**Section sources**
- [favorites.py](file://app/routers/favorites.py#L1-L302)
- [favorites_service.py](file://app/services/favorites_service.py)

## 个股详情页

个股详情页是用户深入了解单只股票的核心界面，它整合了来自多个数据源的全面信息。

该页面的功能特性包括展示股票的基础信息，如公司名称、所属行业、上市日期、总股本和流通股本等。同时，页面会显示实时行情数据，包括当前价格、涨跌幅、成交额和五档买卖盘口。技术分析图表（如K线图）和关键的技术指标（如MACD、RSI）也会在此呈现。

更重要的是，个股详情页是多智能体分析结果的集中展示地。用户可以在此查看针对该股票的最新分析报告，报告内容由市场分析师、基本面分析师和新闻分析师等共同生成。用户还可以在该页面直接启动对该股票的单股分析或将其加入自选股，实现功能的无缝衔接。

**Section sources**
- [stock_models.py](file://app/models/stock_models.py#L1-L246)
- [analysis.py](file://app/models/analysis.py#L139-L150)
- [favorites.py](file://app/routers/favorites.py#L1-L302)