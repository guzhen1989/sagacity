# 社交媒体分析师

<cite>
**本文档引用文件**   
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py)
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py)
- [social_media_service.py](file://app/services/social_media_service.py)
- [social_media.py](file://app/routers/social_media.py)
- [agent_utils.py](file://tradingagents/agents/utils/agent_utils.py)
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md)
</cite>

## 目录
1. [引言](#引言)
2. [系统架构](#系统架构)
3. [核心功能分析](#核心功能分析)
4. [数据采集与处理](#数据采集与处理)
5. [情绪分析模型](#情绪分析模型)
6. [话题聚类与预警机制](#话题聚类与预警机制)
7. [信息整合方式](#信息整合方式)
8. [API接口说明](#api接口说明)
9. [配置与部署](#配置与部署)
10. [总结](#总结)

## 引言

社交媒体分析师是本系统中的关键智能体之一，专注于监控和分析中国主要社交媒体平台上的投资者情绪。该智能体通过采集微博、雪球等平台的用户讨论数据，运用自然语言处理技术识别市场情绪变化，为投资决策提供重要参考。

**Section sources**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L1-L232)

## 系统架构

社交媒体分析师系统采用分层架构设计，包含数据采集层、数据处理层、分析服务层和应用接口层。各组件协同工作，实现从原始数据到深度分析报告的完整流程。

```mermaid
graph TD
A[数据采集层] --> B[数据处理层]
B --> C[分析服务层]
C --> D[应用接口层]
D --> E[前端应用]
A --> |爬取| F[微博]
A --> |爬取| G[雪球]
A --> |爬取| H[抖音]
A --> |爬取| I[知乎]
B --> |标准化| J[消息清洗]
B --> |结构化| K[数据标注]
B --> |存储| L[MongoDB]
C --> |查询| M[消息检索]
C --> |统计| N[情绪分析]
C --> |聚合| O[趋势预测]
D --> |REST API| P[社交情绪分析]
D --> |WebSocket| Q[实时预警]
```

**Diagram sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L33-L542)
- [social_media_service.py](file://app/services/social_media_service.py#L1-L353)
- [social_media.py](file://app/routers/social_media.py#L1-L359)

**Section sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L1-L542)
- [social_media_service.py](file://app/services/social_media_service.py#L1-L353)

## 核心功能分析

社交媒体分析师具备三大核心能力：舆情监控、情绪分析和异常预警。这些功能共同构成了完整的投资者情绪分析体系。

### 舆情监控能力

社交媒体分析师能够实时监控多个平台的用户讨论，重点关注与特定股票相关的讨论热度和关键意见领袖(KOL)观点。

```mermaid
classDiagram
class SocialMediaCrawler {
+platform : str
+headers : dict
+clean_content(text) : str
+extract_hashtags(text) : List[str]
+analyze_sentiment(text) : tuple
+extract_keywords(text) : List[str]
}
class WeiboCrawler {
+base_url : str
+crawl_stock_messages(symbol, limit) : List[Dict]
+_simulate_weibo_api(symbol, limit) : List[Dict]
+_standardize_weibo_message(raw_msg, symbol) : Dict
}
class DouyinCrawler {
+crawl_stock_messages(symbol, limit) : List[Dict]
+_simulate_douyin_api(symbol, limit) : List[Dict]
+_standardize_douyin_message(raw_msg, symbol) : Dict
}
SocialMediaCrawler <|-- WeiboCrawler
SocialMediaCrawler <|-- DouyinCrawler
```

**Diagram sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L33-L542)

### 情绪分析能力

情绪分析模块采用基于规则和关键词的方法，对文本内容进行情感倾向判断，量化投资者情绪强度。

```mermaid
flowchart TD
Start([开始情绪分析]) --> Clean["清洗文本内容"]
Clean --> Extract["提取关键词和标签"]
Extract --> Analyze["分析情绪倾向"]
Analyze --> |正面关键词| Positive["正面情绪"]
Analyze --> |负面关键词| Negative["负面情绪"]
Analyze --> |无明显倾向| Neutral["中性情绪"]
Positive --> Score["计算情绪得分"]
Negative --> Score
Neutral --> Score
Score --> Weight["加权综合评估"]
Weight --> Output["输出情绪分析结果"]
```

**Diagram sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L81-L100)
- [internal_message_crawler.py](file://examples/crawlers/internal_message_crawler.py#L97-L108)

**Section sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L81-L100)

## 数据采集与处理

社交媒体数据采集系统负责从多个平台获取原始讨论数据，并进行标准化处理。

### 数据采集流程

数据采集流程包括平台适配、请求发送、响应解析和数据标准化四个主要步骤。

```mermaid
sequenceDiagram
participant Crawler as 爬虫
participant API as 社交媒体API
participant Service as 数据服务
participant DB as 数据库
Crawler->>API : 发送查询请求
API-->>Crawler : 返回原始数据
Crawler->>Crawler : 清洗和标准化数据
Crawler->>Service : 提交标准化消息
Service->>DB : 批量保存到数据库
DB-->>Service : 返回保存结果
Service-->>Crawler : 返回处理状态
```

**Diagram sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L167-L184)
- [social_media_service.py](file://app/services/social_media_service.py#L80-L137)

### 数据结构定义

系统定义了统一的数据结构来存储社交媒体消息，确保数据的一致性和可查询性。

```mermaid
erDiagram
SOCIAL_MEDIA_MESSAGE {
string message_id PK
string platform
string message_type
text content
datetime publish_time
string sentiment
float sentiment_score
string symbol FK
}
AUTHOR {
string user_id PK
string username
boolean verified
int follower_count
float influence_score
}
ENGAGEMENT {
int likes
int shares
int comments
int views
float engagement_rate
}
SOCIAL_MEDIA_MESSAGE ||--o{ AUTHOR : "发布"
SOCIAL_MEDIA_MESSAGE ||--o{ ENGAGEMENT : "包含"
```

**Diagram sources**
- [social_media.py](file://app/routers/social_media.py#L20-L41)
- [social_media_service.py](file://app/services/social_media_service.py#L56-L353)

**Section sources**
- [social_media.py](file://app/routers/social_media.py#L20-L41)

## 情绪分析模型

情绪分析模型是社交媒体分析师的核心，通过多种技术手段评估投资者情绪。

### 情绪强度评估

系统采用多维度指标评估情绪强度，包括情绪倾向、影响力和可信度。

```mermaid
flowchart TD
A[原始文本] --> B[关键词匹配]
B --> C{正面关键词数量 > 负面?}
C --> |是| D[正面情绪]
C --> |否| E{负面关键词数量 > 正面?}
E --> |是| F[负面情绪]
E --> |否| G[中性情绪]
D --> H[计算情绪得分]
F --> H
G --> H
H --> I[结合影响力加权]
I --> J[结合可信度调整]
J --> K[输出最终情绪评分]
```

**Diagram sources**
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L81-L100)
- [social_media_crawler.py](file://examples/crawlers/social_media_crawler.py#L119-L132)

### 情绪变化趋势分析

系统能够分析情绪随时间的变化趋势，识别情绪转折点。

```mermaid
graph TD
A[按小时聚合] --> B[计算每小时情绪分布]
B --> C[生成情绪时间序列]
C --> D[应用移动平均]
D --> E[识别趋势变化]
E --> F[检测情绪反转信号]
F --> G[输出趋势分析报告]
```

**Diagram sources**
- [social_media.py](file://app/routers/social_media.py#L291-L318)
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md#L634-L659)

**Section sources**
- [social_media.py](file://app/routers/social_media.py#L265-L337)

## 话题聚类与预警机制

系统具备话题聚类和异常情绪预警能力，能够及时发现市场热点和潜在风险。

### 话题聚类算法

采用基于关键词和标签的聚类算法，将相似讨论归为同一话题。

```mermaid
classDiagram
class TopicCluster {
+cluster_id : str
+keywords : List[str]
+hashtags : List[str]
+messages : List[Dict]
+created_at : datetime
+updated_at : datetime
}
class TopicAnalyzer {
+extract_topics(messages) : List[TopicCluster]
+merge_similar_clusters(clusters) : List[TopicCluster]
+calculate_cluster_importance(cluster) : float
}
class SentimentTrendDetector {
+detect_emerging_topics(clusters) : List[str]
+identify_sentiment_shifts(clusters) : List[str]
}
TopicAnalyzer --> TopicCluster
SentimentTrendDetector --> TopicCluster
```

**Diagram sources**
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md#L110-L126)
- [internal_message_crawler.py](file://examples/crawlers/internal_message_crawler.py#L110-L140)

### 异常情绪预警机制

建立多级预警机制，当检测到异常情绪波动时触发预警。

```mermaid
flowchart TD
A[实时监控情绪数据] --> B{情绪波动幅度 > 阈值?}
B --> |是| C[检查消息数量]
C --> D{消息数量 > 基准值?}
D --> |是| E[验证消息可信度]
E --> F{可信度 > 最小要求?}
F --> |是| G[触发预警]
F --> |否| H[标记为可疑]
D --> |否| H
B --> |否| I[继续监控]
G --> J[发送预警通知]
J --> K[记录预警事件]
K --> L[生成分析报告]
```

**Diagram sources**
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md#L206-L223)
- [agent_utils.py](file://tradingagents/agents/utils/agent_utils.py#L1287-L1359)

**Section sources**
- [agent_utils.py](file://tradingagents/agents/utils/agent_utils.py#L1287-L1359)

## 信息整合方式

社交媒体分析师与其他分析模块协同工作，提供全面的市场洞察。

### 与新闻分析师的整合

社交媒体情绪分析与新闻事件分析相结合，提供更完整的市场图景。

```mermaid
graph TB
subgraph 新闻分析
News[新闻事件]
Impact[影响评估]
end
subgraph 社交媒体分析
Social[社交媒体讨论]
Sentiment[情绪分析]
end
News --> Correlation["相关性分析"]
Social --> Correlation
Correlation --> Combined["综合分析报告"]
```

**Diagram sources**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L116-L156)
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md#L85-L108)

### 与市场分析师的整合

将社交媒体情绪指标整合到技术分析和基本面分析中。

```mermaid
flowchart TD
A[技术指标] --> D[综合分析]
B[基本面数据] --> D
C[社交媒体情绪] --> D
D --> E[投资建议]
E --> F[买入/持有/卖出]
```

**Diagram sources**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L140-L153)
- [analysis.py](file://app/models/analysis.py#L33-L54)

**Section sources**
- [social_media_analyst.py](file://tradingagents/agents/analysts/social_media_analyst.py#L140-L153)

## API接口说明

系统提供RESTful API接口，支持外部系统集成和数据查询。

### 主要API端点

| 端点 | 方法 | 描述 | 参数 |
|------|------|------|------|
| /api/social-media/save | POST | 批量保存社交媒体消息 | messages, symbol |
| /api/social-media/query | POST | 查询社交媒体消息 | query parameters |
| /api/social-media/latest/{symbol} | GET | 获取最新消息 | symbol, platform, limit |
| /api/social-media/search | GET | 全文搜索消息 | query, symbol, platform |
| /api/social-media/sentiment-analysis/{symbol} | GET | 获取情绪分析 | symbol, platform, hours_back |

**Section sources**
- [social_media.py](file://app/routers/social_media.py#L68-L337)

## 配置与部署

系统支持灵活的配置选项，可根据需求进行定制化部署。

### 环境变量配置

```bash
# 中国社交媒体平台API密钥
WEIBO_API_KEY=your_weibo_api_key
WEIBO_API_SECRET=your_weibo_api_secret

# 财经数据源
CAILIANSHE_API_KEY=your_cailianshe_key
EASTMONEY_API_KEY=your_eastmoney_key

# 替代Reddit的配置
USE_CHINESE_SOCIAL_MEDIA=true
SOCIAL_MEDIA_PLATFORMS=weibo,xueqiu,eastmoney_guba
```

**Section sources**
- [chinese-social-media-integration.md](file://docs/localization/chinese-social-media-integration.md#L189-L202)

## 总结

社交媒体分析师通过整合微博、雪球等中国主要社交媒体平台的数据，运用自然语言处理技术进行投资者情绪分析，为投资决策提供重要参考。系统具备完整的数据采集、处理、分析和预警能力，能够有效识别市场情绪变化趋势和潜在风险。

该智能体与其他分析模块协同工作，将社交媒体情绪指标整合到全面的市场分析框架中，提升了投资分析的准确性和时效性。未来可进一步优化情绪分析算法，增加更多数据源，提升系统的智能化水平。